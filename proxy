events {
    worker_connections 1024;
}

http {
    server {
        listen 80;

        location / {
            proxy_pass http://127.0.0.1:8080;  # Forward requests to port 8080
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

            access_log /var/log/nginx/api_proxy.log;

            # Enable response interception
            proxy_intercept_errors on;
            error_page 300 599 @intercept;  # Intercept responses with status codes in the range 200-599
        }

        location @intercept {
            # Custom response interception logic goes here
            # You can use sub_filter to modify response content
            # Example:
            # sub_filter "</body>" "<div>Intercepted by Proxy</div></body>";
            # sub_filter_once on;
            # proxy_pass http://127.0.0.1:8081;  # Forward intercepted response to another port or server if needed
        }
    }
}