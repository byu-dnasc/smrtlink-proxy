Bootstrap: docker
From: alpine:latest

%files

    nginx/config/unprivileged.conf /etc/nginx/nginx.conf
    index.html /www/index.html

%environment

    export SMRT_ROOT={{ smrt_root }}

%post
    apk update
    apk add nginx

    ESCAPED_NGINX_PREFIX=$(echo "{{ nginx_prefix }}" | awk '{gsub(/\//,"\\\/"); print}') # parameter expansion would be easier, but bash not available in alpine
    sed -i "s/\/tmp/$ESCAPED_NGINX_PREFIX/" /etc/nginx/nginx.conf
    
%startscript
    # p option is to help nginx find the log created in the post section
    nginx -p {{ nginx_prefix }} -c /etc/nginx/nginx.conf