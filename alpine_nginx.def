Bootstrap: docker
From: alpine:latest

%files

    unpriv_nginx.conf /etc/nginx/nginx.conf
    index.html /www/index.html

%post
    apk update
    apk add nginx

    # using /tmp will work, but this is better, although it assumes smrtlink-proxy is installed in /home/<username>/smrtlink-proxy
    ESCAPED_NGINX_PREFIX=$(echo "{{ nginx_prefix }}" | awk '{gsub(/\//,"\\\/"); print}')
    sed -i "s/\/tmp/$ESCAPED_NGINX_PREFIX/" /etc/nginx/nginx.conf
    
%startscript
    # p option is to help nginx find the log created in the post section
    nginx -p {{ nginx_prefix }} -c /etc/nginx/nginx.conf